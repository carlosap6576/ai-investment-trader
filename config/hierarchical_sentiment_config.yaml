# Hierarchical Sentiment Transformer Configuration
# ================================================
# Configuration for the three-tier sentiment architecture:
# Market -> Sector -> Ticker with FinBERT integration

# Model Architecture
# ------------------
model:
  # Model type selection
  type: "hierarchical"  # Options: "classic", "hierarchical"

  # Core dimensions
  hidden_dim: 256       # Internal transformer dimension
  temporal_dim: 64      # Temporal sequence encoding dimension
  num_heads: 4          # Attention heads per layer

  # Layer configuration
  num_temporal_layers: 2  # Transformer encoder layers

  # Regularization
  dropout: 0.1          # Dropout rate for regularization

# Sequence Configuration
# ----------------------
sequence:
  length: 20            # Number of time steps in input sequence
  feature_dim: 40       # Features per time step (from FeatureBuilder)

# Hierarchical Level Features
# ---------------------------
# Feature allocation per level (total = feature_dim)
features:
  ticker:
    count: 12           # Ticker-level sentiment features
    indices: [0, 11]    # Start/end index in feature vector
  sector:
    count: 10           # Sector-level sentiment features
    indices: [12, 21]
  market:
    count: 10           # Market-level sentiment features
    indices: [22, 31]
  cross_level:
    count: 8            # Cross-level interaction features
    indices: [32, 39]

# Training Configuration
# ----------------------
training:
  # Optimizer settings
  optimizer: "AdamW"
  learning_rate: 0.001
  weight_decay: 0.01

  # Training parameters
  epochs: 200
  batch_size: 1         # Precision training (batch=1)

  # Learning rate scheduler
  scheduler:
    type: "StepLR"
    step_size: 50
    gamma: 0.5

  # Early stopping
  early_stopping:
    patience: 20
    min_delta: 0.001

  # Data split
  train_split: 0.8      # 80% train, 20% test

# Loss Function Configuration
# ---------------------------
loss:
  type: "focal"         # Options: "cross_entropy", "focal"

  # Focal loss parameters (for class imbalance)
  focal:
    gamma: 2.0          # Focusing parameter
    alpha: null         # Class weights (null = auto-calculate)

  # Class weights for imbalanced data
  # Set to null for auto-calculation from training data
  class_weights:
    SELL: 1.0
    HOLD: 0.5           # Lower weight for majority class
    BUY: 1.0

# Signal Thresholds
# -----------------
# Price change thresholds for label assignment
thresholds:
  # For cryptocurrency (high volatility)
  crypto:
    buy: 1.0            # Price increase > 1% = BUY
    sell: -1.0          # Price decrease < -1% = SELL

  # For large cap stocks (low volatility)
  large_cap:
    buy: 0.3
    sell: -0.3

  # For volatile stocks
  volatile:
    buy: 0.5
    sell: -0.5

  # For index ETFs
  index:
    buy: 0.2
    sell: -0.2

# FinBERT Configuration
# ---------------------
finbert:
  model_name: "ProsusAI/finbert"
  max_length: 512       # Maximum token length
  batch_size: 8         # Batch size for sentiment analysis
  cache_embeddings: true

# News Classification
# -------------------
news_classifier:
  # Relevance filtering
  min_relevance_score: 0.3

  # Market-level keywords
  market_keywords:
    - "fed"
    - "fomc"
    - "gdp"
    - "inflation"
    - "recession"
    - "interest rate"
    - "treasury"
    - "economic"
    - "monetary policy"

  # Sector keywords are derived from GICS mapping
  use_gics_mapping: true

# Sentiment Aggregation
# ---------------------
aggregation:
  # Time windows for sentiment aggregation (in minutes)
  windows:
    - 5     # Recent (last 5 min)
    - 15    # Short-term (last 15 min)
    - 60    # Medium-term (last hour)

  # Weighting scheme for aggregation
  weighting: "exponential"  # Options: "uniform", "exponential", "linear"
  decay_rate: 0.1           # For exponential weighting

# Evaluation Metrics
# ------------------
evaluation:
  # Primary metrics
  primary_metrics:
    - "accuracy"
    - "f1_weighted"
    - "directional_accuracy"

  # Trading-specific metrics
  trading_metrics:
    - "signal_accuracy"
    - "hold_accuracy"
    - "simulated_pnl"
    - "sharpe_ratio"
    - "profit_factor"

  # Simulated trading parameters
  simulation:
    transaction_cost: 0.001  # 0.1% per trade
    risk_free_rate: 0.0      # For Sharpe ratio

# Logging and Checkpoints
# -----------------------
logging:
  level: "INFO"
  save_checkpoints: true
  checkpoint_frequency: 10  # Save every N epochs
  log_attention_weights: true

# Device Configuration
# --------------------
device:
  # Auto-detect best available: cuda > mps > cpu
  auto_detect: true
  preferred: "cuda"     # Preferred device if available

# Data Paths
# ----------
paths:
  datasets_dir: "datasets"
  models_dir: "datasets"  # Models saved in symbol subdirectory
  logs_dir: "logs"
